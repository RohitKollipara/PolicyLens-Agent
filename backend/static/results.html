<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>

<!-- Favicon -->
<link rel="icon" href="policy lens.png" type="image/x-icon">
<link rel="icon" type="image/png" sizes="32x32" href="policy lens.png">
<link rel="icon" type="image/png" sizes="16x16" href="policy lens.png">
<link rel="apple-touch-icon" sizes="180x180" href="policy lens.png">

<title>PolicyLens - Analysis Results</title>

<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#4285F4",
                    "g-red": "#EA4335",
                    "g-yellow": "#FBBC05",
                    "g-green": "#34A853",
                    "background-light": "#ffffff",
                    "background-dark": "#202124",
                    "surface-light": "#f8f9fa",
                },
                fontFamily: {
                    "display": ["Inter", "sans-serif"]
                },
                borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "2xl": "2rem", "3xl": "2.5rem", "full": "9999px"},
            },
        },
    }
</script>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-[#202124] dark:text-white overflow-x-hidden transition-colors duration-300">
<div class="fixed inset-0 -z-10 h-full w-full overflow-hidden pointer-events-none">
<div class="absolute -top-[10%] -left-[10%] h-[50vh] w-[50vh] rounded-full bg-primary/20 blur-[120px] dark:bg-primary/10"></div>
<div class="absolute top-[10%] right-[10%] h-[40vh] w-[40vh] rounded-full bg-g-red/15 blur-[100px] dark:bg-g-red/10"></div>
<div class="absolute bottom-[20%] left-[10%] h-[40vh] w-[40vh] rounded-full bg-g-yellow/15 blur-[100px] dark:bg-g-yellow/10"></div>
<div class="absolute -bottom-[10%] right-[20%] h-[50vh] w-[50vh] rounded-full bg-g-green/15 blur-[120px] dark:bg-g-green/10"></div>
</div>
<div class="relative flex min-h-screen flex-col">
<header class="w-full px-6 py-4 lg:px-12 sticky top-0 z-50 backdrop-blur-md bg-white/80 dark:bg-[#202124]/80 border-b border-gray-100 dark:border-white/10">
<div class="mx-auto flex max-w-7xl items-center justify-between">
<div class="flex items-center gap-2.5">
<div class="flex h-10 w-10 items-center justify-center rounded-xl text-white shadow-sm">
    <img src="policy lens.png" alt="PolicyLens" class="h-10 w-10">
</div>
<h2 class="text-2xl font-bold tracking-tight text-[#202124] dark:text-white">
<span>PolicyLens</span>
</h2>
</div>
<div class="flex items-center gap-4">
<button id="darkModeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" title="Toggle dark mode">
    <span class="material-symbols-outlined text-gray-600 dark:text-gray-300">dark_mode</span>
</button>
<a href="index.html" class="inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors">
    <span class="material-symbols-outlined text-lg">arrow_back</span>
    Back to Upload
</a>
</div>
</header>
<main class="flex flex-1 flex-col items-center justify-center px-4 py-8 lg:px-8">
<div class="relative w-full max-w-5xl">
<div class="relative overflow-hidden rounded-3xl border border-white/60 bg-white/60 shadow-[0_8px_32px_0_rgba(66,133,244,0.05)] backdrop-blur-xl dark:border-white/10 dark:bg-[#202124]/60 dark:shadow-none p-6 md:p-8 lg:p-10">
<div class="absolute top-0 right-0 -mt-10 -mr-10 h-32 w-32 rounded-full bg-gradient-to-br from-g-red/20 to-g-yellow/20 blur-2xl"></div>
<div class="absolute bottom-0 left-0 -mb-10 -ml-10 h-32 w-32 rounded-full bg-gradient-to-tr from-primary/20 to-g-green/20 blur-2xl"></div>
<div class="relative z-10">
<div class="mb-6">
<div class="flex items-center justify-between mb-4">
<h1 class="text-3xl font-bold text-[#202124] dark:text-white flex items-center gap-3">
    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center shadow-lg">
        <span class="material-symbols-outlined text-white text-2xl">analytics</span>
    </div>
    Analysis Results
</h1>
<div class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
    <span class="material-symbols-outlined text-xs text-gray-500 dark:text-gray-400">schedule</span>
    <span class="text-xs text-gray-500 dark:text-gray-400">Generated</span>
    <span id="timestamp" class="text-xs font-medium text-gray-700 dark:text-gray-300"></span>
</div>
</div>
<div id="statsBar" class="grid grid-cols-3 gap-4"></div>
</div>

<div id="loadingSpinner" class="text-center py-12 hidden">
  <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
  <p class="mt-4 text-gray-600 dark:text-gray-400">Loading results...</p>
</div>

<div id="resultsContent" class="space-y-6"></div>

<div id="errorMessage" class="hidden p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800">
  <p class="text-red-800 dark:text-red-200 font-medium"></p>
</div>
</div>
</div>
</div>
</main>
<footer class="w-full py-6 text-center border-t border-gray-100 dark:border-white/5 mt-auto bg-surface-light dark:bg-[#202124]">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400"></p>
</footer>
</div>

<script>
const loadingSpinner = document.getElementById("loadingSpinner");
const resultsContent = document.getElementById("resultsContent");
const errorMessage = document.getElementById("errorMessage");
const darkModeToggle = document.getElementById("darkModeToggle");
const timestamp = document.getElementById("timestamp");

// Dark mode toggle
function initDarkMode() {
    const isDark = localStorage.getItem('darkMode') === 'true' || 
                   (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches);
    
    if (isDark) {
        document.documentElement.classList.add('dark');
        darkModeToggle.querySelector('span').textContent = 'light_mode';
    } else {
        document.documentElement.classList.remove('dark');
        darkModeToggle.querySelector('span').textContent = 'dark_mode';
    }
}

darkModeToggle.addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('darkMode', isDark);
    darkModeToggle.querySelector('span').textContent = isDark ? 'light_mode' : 'dark_mode';
});

// Set timestamp
timestamp.textContent = new Date().toLocaleString();

function showError(message) {
    errorMessage.querySelector("p").textContent = message;
    errorMessage.classList.remove("hidden");
    loadingSpinner.classList.add("hidden");
}

function loadResults() {
    const storedData = sessionStorage.getItem('analysisResults');
    
    if (!storedData) {
        showError("No analysis results found. Please go back and run an analysis.");
        return;
    }
    
    try {
        // Log the raw data for debugging
        console.log("Raw stored data length:", storedData.length);
        console.log("Raw stored data preview:", storedData.substring(0, 200));
        
        const data = JSON.parse(storedData);
        console.log("Parsed data:", data);
        
        // Validate data structure
        if (!data || typeof data !== 'object') {
            throw new Error("Invalid data structure");
        }
        
        displayResults(data);
    } catch (e) {
        console.error("Error parsing stored results:", e);
        console.error("Stored data:", storedData);
        
        // Try to show partial data if possible
        try {
            // Try to extract any useful information
            if (storedData.includes('reasoning_summary') || storedData.includes('affected_groups')) {
                // Try to manually parse or show error with more context
                showError(`Error loading results: ${e.message}. The data may be corrupted. Please try running the analysis again.`);
            } else {
                showError("Error loading analysis results. The stored data appears to be invalid. Please go back and run a new analysis.");
            }
        } catch (e2) {
            showError("Error loading analysis results. Please go back and run a new analysis.");
        }
    }
}

function getRiskBadgeClass(riskLevel) {
    const risk = (riskLevel || "").toLowerCase();
    if (risk === "high") {
        return "bg-red-500 text-white border-red-600 dark:bg-red-600 dark:border-red-700";
    } else if (risk === "medium") {
        return "bg-yellow-500 text-white border-yellow-600 dark:bg-yellow-600 dark:border-yellow-700";
    } else {
        return "bg-green-500 text-white border-green-600 dark:bg-green-600 dark:border-green-700";
    }
}

function getRiskIcon(riskLevel) {
    const risk = (riskLevel || "").toLowerCase();
    if (risk === "high") {
        return "warning";
    } else if (risk === "medium") {
        return "info";
    } else {
        return "check_circle";
    }
}

function displayResults(data) {
    loadingSpinner.classList.add("hidden");
    let html = "";
    
    // Validate data structure
    if (!data || typeof data !== 'object') {
        showError("Invalid data structure received. Please try running the analysis again.");
        return;
    }
    
    // Check for error cases - fix the 'in' operator issue
    let hasError = false;
    let isQuotaError = false;
    
    if (data.is_error || data.error_type === "quota_exceeded") {
        hasError = true;
        isQuotaError = data.error_type === "quota_exceeded";
    } else if (data.reasoning_summary && typeof data.reasoning_summary === 'string') {
        const summaryLower = data.reasoning_summary.toLowerCase();
        hasError = summaryLower.includes("quota") || 
                   summaryLower.includes("429") || 
                   summaryLower.includes("resource_exhausted") ||
                   summaryLower.includes("error occurred") ||
                   summaryLower.includes("api quota");
        isQuotaError = summaryLower.includes("quota") || 
                      summaryLower.includes("429") || 
                      summaryLower.includes("resource_exhausted");
    }
    
    if (hasError) {
        
        // Clean up the error message - remove the raw error object if present
        let errorMessage = data.reasoning_summary || "An error occurred during analysis.";
        if (errorMessage.includes("{'error':") || errorMessage.includes('{"error":')) {
            // Extract just the meaningful part
            if (isQuotaError) {
                const retryMatch = errorMessage.match(/retry in (\d+\.?\d*)\s*s/i);
                const retryTime = retryMatch ? retryMatch[1] : "60";
                errorMessage = `API quota exceeded. Free tier limit of 20 requests/day reached. Please retry after ${Math.ceil(parseFloat(retryTime))} seconds or upgrade your API plan.`;
            } else {
                errorMessage = "An error occurred during analysis. Please try again.";
            }
        }
        
        html += `
            <div class="p-6 rounded-xl bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/30 dark:to-orange-900/30 border-2 border-red-300 dark:border-red-700 shadow-lg mb-6">
                <div class="flex items-start gap-4">
                    <div class="flex-shrink-0 w-16 h-16 rounded-full bg-red-500 flex items-center justify-center shadow-lg">
                        <span class="material-symbols-outlined text-white text-3xl">${isQuotaError ? 'hourglass_empty' : 'error'}</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-2xl font-bold mb-3 text-red-900 dark:text-red-100">${isQuotaError ? "API Quota Exceeded" : "Analysis Error"}</h3>
                        <p class="text-red-800 dark:text-red-200 leading-relaxed text-lg mb-4">${errorMessage}</p>
                        ${isQuotaError ? `
                            <div class="mt-4 p-4 bg-white/60 dark:bg-gray-800/60 rounded-lg border border-red-200 dark:border-red-800">
                                <p class="text-sm font-semibold text-red-900 dark:text-red-100 mb-2">What to do:</p>
                                <ul class="list-disc list-inside space-y-1 text-sm text-red-800 dark:text-red-200">
                                    <li>Wait for the retry period to expire (check the message above for exact time)</li>
                                    <li>Check your API quota at <a href="https://ai.dev/usage" target="_blank" class="underline font-semibold">ai.dev/usage</a></li>
                                    <li>Consider upgrading your API plan for higher limits</li>
                                    <li>Try again later or use a different API key</li>
                                </ul>
                            </div>
                        ` : ""}
                    </div>
                </div>
            </div>
        `;
        
        // Still show mitigations if available
        if (data.mitigations && data.mitigations.length > 0) {
            html += `
                <div class="p-6 rounded-xl bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 border border-yellow-200 dark:border-yellow-800 shadow-lg">
                    <h3 class="text-xl font-bold mb-4 text-yellow-900 dark:text-yellow-100 flex items-center gap-2">
                        <span class="material-symbols-outlined text-yellow-600 dark:text-yellow-400">lightbulb</span>
                        Suggested Actions
                    </h3>
                    <ul class="space-y-2">
            `;
            data.mitigations.forEach((mitigation, index) => {
                html += `
                    <li class="flex items-start gap-3 p-3 rounded-lg bg-white/60 dark:bg-gray-800/60">
                        <span class="text-yellow-600 dark:text-yellow-400 font-bold mt-0.5">${index + 1}.</span>
                        <span class="text-yellow-900 dark:text-yellow-100 flex-1">${mitigation}</span>
                    </li>
                `;
            });
            html += `</ul></div>`;
        }
        
        resultsContent.innerHTML = html;
        return;
    }
    
    // Check if we have any valid data
    const hasSummary = data.reasoning_summary && typeof data.reasoning_summary === 'string' && data.reasoning_summary.trim().length > 0;
    const hasGroups = Array.isArray(data.affected_groups) && data.affected_groups.length > 0;
    const hasMitigations = Array.isArray(data.mitigations) && data.mitigations.length > 0;
    
    if (!hasSummary && !hasGroups && !hasMitigations) {
        html += `
            <div class="p-6 rounded-xl bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 border-2 border-yellow-300 dark:border-yellow-700 shadow-lg">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 rounded-full bg-yellow-500 flex items-center justify-center">
                        <span class="material-symbols-outlined text-white text-2xl">info</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-2 text-yellow-900 dark:text-yellow-100">No Results Available</h3>
                        <p class="text-yellow-800 dark:text-yellow-200 leading-relaxed">The analysis completed but no results were returned. This may indicate an issue with the analysis or the data provided.</p>
                        <button onclick="window.location.href='index.html'" class="mt-4 px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg font-semibold transition-colors">
                            Go Back and Try Again
                        </button>
                    </div>
                </div>
            </div>
        `;
        resultsContent.innerHTML = html;
        return;
    }
    
    // Update stats bar
    const statsBar = document.getElementById('statsBar');
    if (statsBar) {
        const groupCount = data.affected_groups ? data.affected_groups.length : 0;
        const mitigationCount = data.mitigations ? data.mitigations.length : 0;
        const highRiskCount = data.affected_groups ? data.affected_groups.filter(g => g.risk_level && g.risk_level.toLowerCase() === 'high').length : 0;
        
        statsBar.innerHTML = `
            <div class="p-4 rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-800 text-center">
                <div class="text-3xl font-bold text-blue-600 dark:text-blue-400 mb-1">${groupCount}</div>
                <div class="text-xs font-semibold text-blue-800 dark:text-blue-200 uppercase tracking-wide">Affected Groups</div>
            </div>
            <div class="p-4 rounded-xl bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 border border-red-200 dark:border-red-800 text-center">
                <div class="text-3xl font-bold text-red-600 dark:text-red-400 mb-1">${highRiskCount}</div>
                <div class="text-xs font-semibold text-red-800 dark:text-red-200 uppercase tracking-wide">High Risk</div>
            </div>
            <div class="p-4 rounded-xl bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200 dark:border-green-800 text-center">
                <div class="text-3xl font-bold text-green-600 dark:text-green-400 mb-1">${mitigationCount}</div>
                <div class="text-xs font-semibold text-green-800 dark:text-green-200 uppercase tracking-wide">Recommendations</div>
            </div>
        `;
    }
    
    // Show demographic data usage indicator
    if (data.demographics_used) {
        html += `
            <div class="p-5 rounded-xl bg-gradient-to-r from-green-50 via-emerald-50 to-teal-50 dark:from-green-900/30 dark:via-emerald-900/30 dark:to-teal-900/30 border-2 border-green-200 dark:border-green-800 mb-6 shadow-lg relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-green-200/30 dark:bg-green-800/30 rounded-full -mr-12 -mt-12 blur-xl"></div>
                <div class="relative z-10 flex items-center gap-4 text-green-800 dark:text-green-200">
                    <div class="w-16 h-16 rounded-full bg-green-500 flex items-center justify-center shadow-xl">
                        <span class="material-symbols-outlined text-white text-3xl">check_circle</span>
                    </div>
                    <div>
                        <span class="font-bold text-lg">Demographic data integrated</span>
                        <p class="text-sm text-green-700 dark:text-green-300 mt-1">Analysis enhanced with CSV demographic evidence</p>
                    </div>
                </div>
            </div>
        `;
    }
    
    // Reasoning Summary
    if (data.reasoning_summary) {
        html += `
            <div class="p-6 rounded-xl bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-blue-900/20 dark:via-indigo-900/20 dark:to-purple-900/20 border-2 border-blue-200 dark:border-blue-800 shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-blue-200/20 dark:bg-blue-800/20 rounded-full -mr-16 -mt-16 blur-2xl"></div>
                <div class="absolute bottom-0 left-0 w-24 h-24 bg-indigo-200/20 dark:bg-indigo-800/20 rounded-full -ml-12 -mb-12 blur-xl"></div>
                <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg">
                            <span class="material-symbols-outlined text-white text-2xl">summarize</span>
                        </div>
                        <h3 class="text-2xl font-bold text-blue-900 dark:text-blue-100">Executive Summary</h3>
                    </div>
                    <div class="pl-2 border-l-4 border-blue-500 dark:border-blue-400">
                        <p class="text-blue-900 dark:text-blue-100 leading-relaxed text-lg font-medium">${data.reasoning_summary}</p>
                    </div>
                </div>
            </div>
        `;
    }
    
    // Affected Groups with Risk Levels
    if (data.affected_groups && data.affected_groups.length > 0) {
        html += `
            <div class="p-6 rounded-xl bg-gradient-to-br from-white to-gray-50 dark:from-[#303134] dark:to-[#2a2c2e] border-2 border-gray-200 dark:border-white/10 shadow-xl">
                <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-200 dark:border-white/10">
                    <div class="w-12 h-12 rounded-full bg-primary/10 dark:bg-primary/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary text-3xl">groups</span>
                    </div>
                    <h3 class="text-2xl font-bold text-[#202124] dark:text-white">Affected Groups</h3>
                </div>
                <div class="space-y-5">
        `;
        
        data.affected_groups.forEach((group, index) => {
            const riskLevel = group.risk_level || "Unknown";
            const riskBadgeClass = getRiskBadgeClass(riskLevel);
            const riskIcon = getRiskIcon(riskLevel);
            const riskColor = riskLevel.toLowerCase();
            
            html += `
                <div class="p-6 rounded-xl border-2 ${riskColor === 'high' ? 'border-red-300 dark:border-red-700 bg-gradient-to-br from-red-50 to-red-100/50 dark:from-red-900/20 dark:to-red-900/10' : riskColor === 'medium' ? 'border-yellow-300 dark:border-yellow-700 bg-gradient-to-br from-yellow-50 to-yellow-100/50 dark:from-yellow-900/20 dark:to-yellow-900/10' : 'border-green-300 dark:border-green-700 bg-gradient-to-br from-green-50 to-green-100/50 dark:from-green-900/20 dark:to-green-900/10'} shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 rounded-full ${riskColor === 'high' ? 'bg-red-500' : riskColor === 'medium' ? 'bg-yellow-500' : 'bg-green-500'} flex items-center justify-center text-white font-bold shadow-md">
                                    ${index + 1}
                                </div>
                                <h4 class="text-xl font-bold ${riskColor === 'high' ? 'text-red-900 dark:text-red-100' : riskColor === 'medium' ? 'text-yellow-900 dark:text-yellow-100' : 'text-green-900 dark:text-green-100'}">
                                    ${group.group || `Group ${index + 1}`}
                                </h4>
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="px-8 py-4 rounded-full ${riskBadgeClass} border-2 text-xl font-bold flex items-center gap-3 shadow-xl transform hover:scale-105 transition-transform">
                                <span class="material-symbols-outlined text-2xl">${riskIcon}</span>
                                <span>${riskLevel}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${group.regions && group.regions.length > 0 ? `
                        <div class="mt-5 pt-5 border-t-2 ${riskColor === 'high' ? 'border-red-200 dark:border-red-800' : riskColor === 'medium' ? 'border-yellow-200 dark:border-yellow-800' : 'border-green-200 dark:border-green-800'}">
                            <p class="text-sm font-bold text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2 uppercase tracking-wide">
                                <span class="material-symbols-outlined text-lg">location_on</span>
                                Affected Regions
                            </p>
                            <div class="flex flex-wrap gap-3">
                                ${group.regions.map(region => `
                                    <span class="px-4 py-2 rounded-lg bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-600 text-sm font-semibold text-gray-700 dark:text-gray-300 shadow-md hover:shadow-lg transition-shadow flex items-center gap-2">
                                        <span class="material-symbols-outlined text-xs">place</span>
                                        ${region}
                                    </span>
                                `).join("")}
                            </div>
                        </div>
                    ` : ""}
                </div>
            `;
        });
        
        html += `
                </div>
            </div>
        `;
    }
    
    // Mitigations/Recommendations
    if (data.mitigations && data.mitigations.length > 0) {
        html += `
            <div class="p-6 rounded-xl bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 dark:from-green-900/20 dark:via-emerald-900/20 dark:to-teal-900/20 border-2 border-green-200 dark:border-green-800 shadow-xl">
                <div class="flex items-center gap-3 mb-6 pb-4 border-b-2 border-green-200 dark:border-green-800">
                    <div class="w-12 h-12 rounded-full bg-green-500 flex items-center justify-center shadow-lg">
                        <span class="material-symbols-outlined text-white text-3xl">shield</span>
                    </div>
                    <h3 class="text-2xl font-bold text-green-900 dark:text-green-100">Recommendations</h3>
                </div>
                <ul class="space-y-4">
        `;
        
        data.mitigations.forEach((mitigation, index) => {
            html += `
                <li class="flex items-start gap-4 p-5 rounded-xl bg-white/80 dark:bg-gray-800/80 border-2 border-green-200 dark:border-green-800/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 hover:border-green-300 dark:hover:border-green-700">
                    <div class="flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 text-white flex items-center justify-center font-bold text-lg shadow-lg transform hover:scale-110 transition-transform">
                        ${index + 1}
                    </div>
                    <div class="flex-1 pt-1">
                        <span class="text-green-900 dark:text-green-100 leading-relaxed text-base font-medium">${mitigation}</span>
                    </div>
                    <span class="material-symbols-outlined text-green-500 dark:text-green-400 text-xl">arrow_forward</span>
                </li>
            `;
        });
        
        html += `
                </ul>
            </div>
        `;
    }
    
    resultsContent.innerHTML = html;
}

// Initialize dark mode
initDarkMode();

// Load results on page load
loadResults();
</script>

</body>
</html>
